<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Aura Affinity Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <style>
        body {
            background-color: #111;
            color: #eee;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        h1 {
            color: gold;
            margin-top: 1rem;
        }

        #map {
            height: 60vh;
            width: 100%;
        }

        #filter {
            margin: 1em;
            color: #fff;
        }

        #list {
            width: 90%;
            margin: auto;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th,
        td {
            padding: 0.5em;
            border: 1px solid #333;
        }

        th {
            background-color: #333;
        }
    </style>
</head>

<body>
    <h1>Aura Affinity Map</h1>
    <p>A living network of verified businesses using the name "Aura" across global industries</p>

    <div id="filter">
        Filter by Category:
        <select id="categoryFilter">
            <option value="All">All</option>
        </select>
    </div>

    <div id="map"></div>
    <div id="list"></div>

    <script>
        const map = L.map('map').setView([20, 0], 2);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        const markers = [];
        const colors = {
            "Health & Wellbeing": "#e91e63",
            "Creative Industries": "#9c27b0",
            "Event Management": "#3f51b5",
            "Accommodation": "#03a9f4",
            "Cities & Developments": "#4caf50",
            "Unverified": "#607d8b"
        };

        const colorIcon = (color) => new L.Icon({
            iconUrl: `https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|${color.replace('#', '')}`,
            iconSize: [21, 34],
            iconAnchor: [10, 34],
            popupAnchor: [1, -34]
        });

        fetch('aura-affinity.csv')
            .then(response => response.text())
            .then(csv => {
                const data = Papa.parse(csv, { header: true }).data;
                const table = document.createElement('table');
                const header = table.insertRow();
                ["Name", "Category", "Country", "Website", "Verified"].forEach(h => header.insertCell().textContent = h);

                const categories = new Set();

                data.forEach(entry => {
                    if (!entry.latitude || !entry.longitude) return;

                    const color = colors[entry.category] || colors["Unverified"];
                    const marker = L.marker([entry.latitude, entry.longitude], {
                        icon: colorIcon(color)
                    }).addTo(map);
                    marker.bindPopup(`<b>${entry.name}</b><br>${entry.category}<br>${entry.country}<br><a href='${entry.website}' target='_blank'>Visit</a>`);
                    markers.push({ marker, category: entry.category });

                    const row = table.insertRow();
                    [entry.name, entry.category, entry.country, entry.website, entry.verified].forEach(text => {
                        const cell = row.insertCell();
                        cell.innerHTML = text.includes('http') ? `<a href="${text}" target="_blank">${text}</a>` : text;
                    });

                    categories.add(entry.category);
                });

                document.getElementById('list').appendChild(table);

                const filter = document.getElementById('categoryFilter');
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    filter.appendChild(option);
                });

                filter.addEventListener('change', () => {
                    const selected = filter.value;
                    markers.forEach(({ marker, category }) => {
                        if (selected === "All" || category === selected) {
                            marker.addTo(map);
                        } else {
                            map.removeLayer(marker);
                        }
                    });
                });
            });
    </script>
</body>

</html>
