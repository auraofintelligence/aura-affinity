<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aura Affinity Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-sA+e2PKV0Tn7HC3j7iU0IT4X1I4Kx8W3SX7CcLkSauU=" crossorigin="" />
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #111;
            color: #f1f1f1;
        }
        h1, p {
            text-align: center;
        }
        #map {
            height: 500px;
            width: 100%;
        }
        #list {
            padding: 20px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #222;
        }
        th, td {
            border: 1px solid #555;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #333;
        }
        select {
            background: #333;
            color: #f1f1f1;
            border: 1px solid #555;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1 style="color: gold">Aura Affinity Map</h1>
    <p>A living network of verified businesses using the name "Aura" across global industries</p>
    <div style="text-align:center; margin-bottom:10px">
        Filter by Category: 
        <select id="categoryFilter" onchange="filterMarkers()">
            <option value="All">All</option>
        </select>
    </div>
    <div id="map"></div>
    <div id="list"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-o9N1jG8S+1UwxzjPIl9zL1hzQzHlZk6lKAau8U2y57w=" crossorigin=""></script>
    <script>
        const categoryColors = {
            "Health & Wellbeing": "red",
            "Creative Industries": "orange",
            "Event Management": "yellow",
            "Accommodation": "green",
            "Cities & Developments": "blue",
            "Other": "gray",
            "Unverified": "gray"
        };

        let map = L.map('map').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];
        let data = [];

        fetch('aura-affinity.csv')
            .then(response => response.text())
            .then(text => {
                const rows = text.trim().split('\n');
                const headers = rows[0].split(',');
                data = rows.slice(1).map(row => {
                    const values = row.split(',');
                    const obj = {};
                    headers.forEach((header, i) => obj[header.trim()] = values[i]?.trim());
                    return obj;
                });
                renderMarkers();
                renderList();
                populateFilter();
            });

        function getColor(category) {
            return categoryColors[category] || categoryColors["Other"];
        }

        function renderMarkers() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            const filter = document.getElementById('categoryFilter').value;
            data.forEach(entry => {
                if (filter !== "All" && entry.category !== filter) return;
                const marker = L.circleMarker([entry.latitude, entry.longitude], {
                    color: getColor(entry.verified === 'false' ? 'Unverified' : entry.category),
                    radius: 8,
                    fillOpacity: 0.9
                }).addTo(map).bindPopup(`<b>${entry.name}</b><br>${entry.category}<br>${entry.country}<br><a href='${entry.website}' target='_blank'>Visit Website</a>`);
                markers.push(marker);
            });
        }

        function renderList() {
            const filter = document.getElementById('categoryFilter').value;
            const filteredData = filter === "All" ? data : data.filter(d => d.category === filter);
            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Country</th>
                            <th>Website</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredData.map(entry => `
                            <tr>
                                <td>${entry.name}</td>
                                <td>${entry.category}</td>
                                <td>${entry.country}</td>
                                <td><a href="${entry.website}" target="_blank">${entry.website}</a></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('list').innerHTML = html;
        }

        function populateFilter() {
            const categories = [...new Set(data.map(d => d.category))];
            const filter = document.getElementById('categoryFilter');
            categories.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                filter.appendChild(opt);
            });
        }

        function filterMarkers() {
            renderMarkers();
            renderList();
        }
    </script>
</body>
</html>
